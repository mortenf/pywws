<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Comment configurer la journalisation horaire avec pywws &mdash; documentation pywws 13.09_r1069</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '13.09_r1069',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/pywws_logo.ico"/>
    <link rel="top" title="documentation pywws 13.09_r1069" href="../index.html" />
    <link rel="up" title="Guides utilisateur" href="index.html" />
    <link rel="next" title="Comment configurer le mode ‘live’ avec pywws" href="livelogging.html" />
    <link rel="prev" title="Comment démarrer avec pywws" href="getstarted.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Index des modules Python"
             >modules</a> |</li>
        <li class="right" >
          <a href="livelogging.html" title="Comment configurer le mode ‘live’ avec pywws"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="getstarted.html" title="Comment démarrer avec pywws"
             accesskey="P">précédent</a> |</li>
        <li><a href="../index.html">documentation pywws 13.09_r1069</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Guides utilisateur</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="how-to-set-up-hourly-logging-with-pywws">
<h1>Comment configurer la journalisation horaire avec pywws<a class="headerlink" href="#how-to-set-up-hourly-logging-with-pywws" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pywws offre deux modes de fonctionnement très différents. Habituellement le programme <a class="reference internal" href="../api/pywws.Hourly.html#module-pywws.Hourly" title="pywws.Hourly"><code class="xref py py-mod docutils literal"><span class="pre">Hourly</span></code></a> devrait être exécuté à intervale régulier (habituellement chaque heure) à partir d&#8217;une tâche programmée (Cron). Ceci convient aux sites Web plutôt statiques, mais des mises à jour plus fréquentes peuvent être utiles pour des sites comme Weather Underground (<a class="reference external" href="http://www.wunderground.com/">http://www.wunderground.com/</a>). Le plus récent programme <a class="reference internal" href="../api/pywws.LiveLog.html#module-pywws.LiveLog" title="pywws.LiveLog"><code class="xref py py-mod docutils literal"><span class="pre">LiveLog</span></code></a> s&#8217;exécute continuellement et peut envoyer des données à chaque 48 secondes.</p>
<p>Notez: bien que ce document (et le nom du programme) réfère à la journalisation horaire (hourly), vous pouvez exécuter le programme  <a class="reference internal" href="../api/pywws.Hourly.html#module-pywws.Hourly" title="pywws.Hourly"><code class="xref py py-mod docutils literal"><span class="pre">Hourly</span></code></a> aussi souvent ou peu fréquemment que vous le souhaitez, mais n&#8217;essayez pas de l&#8217;exécuter plus souvent que le double de la fréquence d&#8217;historique. Par exemple, si votre intervalle d&#8217;historique est de 10 minutes, n&#8217;exécutez pas  <a class="reference internal" href="../api/pywws.Hourly.html#module-pywws.Hourly" title="pywws.Hourly"><code class="xref py py-mod docutils literal"><span class="pre">Hourly</span></code></a> plus fréquemment qu&#8217;aux 20 minutes.</p>
</div>
<div class="section" id="getting-started">
<h2>Mise en route<a class="headerlink" href="#getting-started" title="Lien permanent vers ce titre">¶</a></h2>
<p>Avant tout, vous devez installer pywws et vous assurer qu&#8217;il reçoit bien les informations de votre station météo. Voir <a class="reference internal" href="getstarted.html"><em>Comment démarrer avec pywws</em></a> pour plus de détails.</p>
<p>Essayez d&#8217;exécuter  <a class="reference internal" href="../api/pywws.Hourly.html#module-pywws.Hourly" title="pywws.Hourly"><code class="xref py py-mod docutils literal"><span class="pre">Hourly</span></code></a> à partir de la ligne de commande, avec un haut niveau de commentaires pour que vous puissiez voir ce qui se passe:</p>
<div class="highlight-python"><div class="highlight"><pre>python -m pywws.Hourly -vvv ~/weather/data
</pre></div>
</div>
<p>En moins de cinq minutes (assumant que votre intervalle de relevé soit de 5 minutes) vous devriez voir le message &#8216;live_data new ptr&#8217;, suivi par la recherche et le traitement de nouvelles données de la station météorologique.</p>
</div>
<div class="section" id="configuring-file-locations">
<h2>Configurer l&#8217;emplacement des fichiers<a class="headerlink" href="#configuring-file-locations" title="Lien permanent vers ce titre">¶</a></h2>
<p>Ouvrez votre fichier weather.ini avec un éditeur de texte. Vous devriez avoir une section <code class="docutils literal"><span class="pre">[paths]</span></code> similaire à ce qui suit (où <code class="docutils literal"><span class="pre">xxx</span></code> est votre nom d&#8217;usager):</p>
<div class="highlight-python"><div class="highlight"><pre>[paths]
work = /tmp/weather
templates = /home/xxx/weather/templates/
graph_templates = /home/xxx/weather/graph_templates/
</pre></div>
</div>
<p>Éditez pour correspondre à votre installation et à vos préférences. <code class="docutils literal"><span class="pre">work</span></code> est un dossier temporaire utilisé pour emmagasiner les fichiers intermédiaires, <code class="docutils literal"><span class="pre">templates</span></code> est le dossier où vous gardez vos fichiers de gabarit texte et <code class="docutils literal"><span class="pre">graph_templates</span></code> est le dossier où vous gardez vos fichiers de gabarit graphes. Ne pas utiliser les dossiers exemple de pywws pour celà, puisqu&#8217;ils seront écrasés lors de mise à jour de pywws.</p>
<p>Copiez vos fichiers de gabarits texte et graphes dans les dossiers appropriés. Vous pouvez trouver les quelques exemples fournis avec pywws fort utiles pour débuter.  Si vous avez installé pywws avec la commande <code class="docutils literal"><span class="pre">pip</span></code>, les exemples devrait se trouver dans le dossier <code class="docutils literal"><span class="pre">/usr/share/pywws</span></code> ou <code class="docutils literal"><span class="pre">/usr/local/share/pywws</span></code> ou similaire.</p>
</div>
<div class="section" id="configuring-periodic-tasks">
<h2>Configurer les tâches périodiques<a class="headerlink" href="#configuring-periodic-tasks" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans weather.ini vous devriez avoir les sections <code class="docutils literal"><span class="pre">[logged]</span></code>, <code class="docutils literal"><span class="pre">[hourly]</span></code>, <code class="docutils literal"><span class="pre">[12</span> <span class="pre">hourly]</span></code> et <code class="docutils literal"><span class="pre">[daily]</span></code> similaires à celle-ci:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">logged</span><span class="p">]</span>
<span class="n">services</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">twitter</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">plot</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>

<span class="p">[</span><span class="n">hourly</span><span class="p">]</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Ces sections spécifient ce que devrait faire <a class="reference internal" href="../api/pywws.Hourly.html#module-pywws.Hourly" title="pywws.Hourly"><code class="xref py py-mod docutils literal"><span class="pre">Hourly</span></code></a> à chaque exécution. Les tâches dans la section <code class="docutils literal"><span class="pre">[logged]</span></code> sont réalisées à chaque fois qu&#8217;une nouvelle donnée est enregistrée, les tâches dans la section <code class="docutils literal"><span class="pre">[hourly]</span></code> sont exécutées à chaque heure, les tâches dans la section <code class="docutils literal"><span class="pre">[12</span> <span class="pre">hourly]</span></code> sont lancées deux fois par jour, tandis que les tâches dans la section <code class="docutils literal"><span class="pre">[daily]</span></code> sont réalisées une fois par jour.</p>
<p>Les entrées dans <code class="docutils literal"><span class="pre">services</span></code> sont une liste de services météo en ligne sur lesquels envoyer vos données météo. Les entrées <code class="docutils literal"><span class="pre">plot</span></code> et <code class="docutils literal"><span class="pre">text</span></code> sont des listes de fichiers gabarits graphes et textes à téléverser sur votre site web, et l&#8217;entrée <code class="docutils literal"><span class="pre">twitter</span></code> est une liste de gabarits pour les messages à poster sur Twitter. Ajoutez le nom de vos fichiers de gabarit et de services météo à l&#8217;entrée correspondante, par exemple:</p>
<div class="highlight-python"><div class="highlight"><pre>[logged]
services = [&#39;underground&#39;, &#39;metoffice&#39;]
twitter = []
plot = []
text = []

[hourly]
services = []
twitter = [&#39;tweet.txt&#39;]
plot = [&#39;7days.png.xml&#39;, &#39;24hrs.png.xml&#39;, &#39;rose_24hrs.png.xml&#39;]
text = [&#39;24hrs.txt&#39;, &#39;6hrs.txt&#39;, &#39;7days.txt&#39;]

[12 hourly]
services = []
twitter = []
plot = []
text = []

[daily]
services = []
twitter = [&#39;forecast.txt&#39;]
plot = [&#39;28days.png.xml&#39;]
text = [&#39;allmonths.txt&#39;]
</pre></div>
</div>
<p>Vous pouvez réaliser un test de bon fonctionnement en enlevant la section <code class="docutils literal"><span class="pre">last</span> <span class="pre">update</span></code> du fichier weather.ini, puis exécutez <a class="reference internal" href="../api/pywws.Hourly.html#module-pywws.Hourly" title="pywws.Hourly"><code class="xref py py-mod docutils literal"><span class="pre">Hourly</span></code></a> de nouveau:</p>
<div class="highlight-python"><div class="highlight"><pre>python -m pywws.Hourly -v ~/weather/data
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">Modifié dans la version 13.05_r1009: </span>The last update information was previously stored in weather.ini, with <code class="docutils literal"><span class="pre">last</span> <span class="pre">update</span></code> entries in several sections.</p>
</div>
</div>
<div class="section" id="using-a-utility-script">
<h2>Utilisation d&#8217;un script<a class="headerlink" href="#using-a-utility-script" title="Lien permanent vers ce titre">¶</a></h2>
<p>L&#8217;installation de pywws inclu un petit script <code class="docutils literal"><span class="pre">pywws-hourly.py</span></code> à installer dans <code class="docutils literal"><span class="pre">/usr/bin</span></code> ou <code class="docutils literal"><span class="pre">/usr/local/bin</span></code> ou similaire. Vous devriez être en mesure d&#8217;utiliser ce script en exécutant <a class="reference internal" href="../api/pywws.Hourly.html#module-pywws.Hourly" title="pywws.Hourly"><code class="xref py py-mod docutils literal"><span class="pre">Hourly</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre>pywws-hourly.py -v ~/weather/data
</pre></div>
</div>
</div>
<div class="section" id="run-as-a-cron-job">
<h2>Exécuter en tant que tâche &#8216;cron&#8217;<a class="headerlink" href="#run-as-a-cron-job" title="Lien permanent vers ce titre">¶</a></h2>
<p>La plupart des systèmes UNIX/Linux possèdent un service &#8216;cron&#8217; qui à pour but d&#8217;exécuter un programme spécifié à un intervalle défini, même si vous n&#8217;êtes pas connecté à votre session. Vous éditez un fichier &#8216;crontab&#8217; pour spécifier ce qui doit être exécuté et quand. Par exemple, pour exécuter <a class="reference internal" href="../api/pywws.Hourly.html#module-pywws.Hourly" title="pywws.Hourly"><code class="xref py py-mod docutils literal"><span class="pre">Hourly</span></code></a> à chaque heure, à zéro minutes de l&#8217;heure:</p>
<div class="highlight-python"><div class="highlight"><pre>0 * * * *       pywws-hourly.py /home/jim/weather/data
</pre></div>
</div>
<p>Ceci devrait fonctionner, mais si ce n&#8217;est pas le cas vous n&#8217;obtiendrez probablement pas de messages d&#8217;erreur vous indiquant ce qui ne va pas. Il est préférable d&#8217;exécuter un script qui lance <a class="reference internal" href="../api/pywws.Hourly.html#module-pywws.Hourly" title="pywws.Hourly"><code class="xref py py-mod docutils literal"><span class="pre">Hourly</span></code></a> puis vous envoi un courriel avec tout message qui aurait pu être produit. Voici le script que j&#8217;utilise:</p>
<div class="highlight-python"><div class="highlight"><pre>#!/bin/sh
#
# weather station logger calling script

if [ ! -d /data/weather/ ]; then
  exit
  fi

log=/var/log/log-weather

pywws-hourly.py -v /data/weather &gt;$log 2&gt;&amp;1

# mail the log file
/home/jim/scripts/email-log.sh $log &quot;weather log&quot;
</pre></div>
</div>
<p>Vous devrez éditer beaucoup pour adapter à vos emplacements de dossier et ainsi de suite, mais il donne une certaine idée de ce qui peut être fait.</p>
<p>Commentaires ou questions? SVP, souscrivez à la liste d&#8217;envoi de pywws <a class="reference external" href="http://groups.google.com/group/pywws">http://groups.google.com/group/pywws</a> et laissez-le nous savoir.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/pywws_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table des Matières</a></h3>
  <ul>
<li><a class="reference internal" href="#">Comment configurer la journalisation horaire avec pywws</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#getting-started">Mise en route</a></li>
<li><a class="reference internal" href="#configuring-file-locations">Configurer l&#8217;emplacement des fichiers</a></li>
<li><a class="reference internal" href="#configuring-periodic-tasks">Configurer les tâches périodiques</a></li>
<li><a class="reference internal" href="#using-a-utility-script">Utilisation d&#8217;un script</a></li>
<li><a class="reference internal" href="#run-as-a-cron-job">Exécuter en tant que tâche &#8216;cron&#8217;</a></li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="getstarted.html"
                        title="Chapitre précédent">Comment démarrer avec pywws</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="livelogging.html"
                        title="Chapitre suivant">Comment configurer le mode &#8216;live&#8217; avec pywws</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Index des modules Python"
             >modules</a> |</li>
        <li class="right" >
          <a href="livelogging.html" title="Comment configurer le mode ‘live’ avec pywws"
             >suivant</a> |</li>
        <li class="right" >
          <a href="getstarted.html" title="Comment démarrer avec pywws"
             >précédent</a> |</li>
        <li><a href="../index.html">documentation pywws 13.09_r1069</a> &raquo;</li>
          <li><a href="index.html" >Guides utilisateur</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2008-13, Jim Easterbrook.
      Créé avec <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b2.
    </div>
  </body>
</html>